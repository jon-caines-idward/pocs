<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GA4 AudienceLift - gtag</title>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-P38QHLDQGM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-P38QHLDQGM');
</script>
</head>
<body>
  <h1>Sending AudienceLift Signals to GA4 using gtag</h1>
  <input 
    id="audSig"
    type="text"
    value="12345"
    placeholder="Enter audience signal"
  />
  â€‹<a href="#" name="button1" onclick="
  var audSigEl = document.getElementById('audSig');
  var audSig = audSigEl ? audSigEl.value : '';

  // User property: all active cohorts - has to be set before event call - but this has implications
  //    it means an event call need to occur or the user inserts our code block below in the datalayer push above
  //    to be explored
  (function() {
    var storedCohorts = localStorage.getItem('cohort_ids');
    if(!storedCohorts) return;

    var cohortList = storedCohorts
      .split(',')
      .map(c => c.trim())
      .filter(c => c.length > 0);
    if(cohortList.length === 0) return;

    gtag('set', 'user_properties', { anonymised_audiences: cohortList.join(',') });
    console.log('Cohorts set, user scoped, via gtag: ', cohortList);
  })();

  // Event-scoped cohort parameter
  if(audSig) {
    gtag('event', 'AudienceLiftEntry', { 'audience_signal': audSig });
    console.log('AudienceLiftEntry cohort sent, event scoped, via gtag: ', audSig, ' and cohorts sent as user scoped param');
  }
">Send Signals to GA4 via gtag</a>
</body>
</html>
